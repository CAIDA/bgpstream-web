Data and meta-data access layer
=======================

The data and meta-data access layer provides to the upper layer
information about BGP data availability as data annotations.
For each dump, we annotate:

* the path to the dump (local or remote)
* the project name
* the collector name 
* the BGP type (i.e. ribs or updates)
* the nominal initial timestamp
* the duration (i.e. the time interval covered by the dump)
* the time the dump was published to the Data Provider

<br>

We provide four data interfaces to access the meta-data:

* **BGPStream  Broker** provides pseudo-real time access to the
<a href="{{ path('caida_bgpstream_web_homepage', {'page':
'data'})}}">Data Providers</a>

* **csvfile**, **sqlite**, **singlefile** are useful when the user
  wants to access its own data providers (e.g. own collection of
  local/remote files)


<br>

## BGPStream  Broker

We provide a unified query interface to retrieve streams of data from
different 
<a href="{{ path('caida_bgpstream_web_homepage', {'page': 'data'})}}">data providers</a>
(e.g. Route Views, RIPE RIS) through a web service called
<a href="{{ path('caida_bgpstream_web_homepage_docs', {'page': 'api', 'subpage':'broker'})}}">BGPStream Broker</a>
 which provides the following functionalities:

 * Provide meta-data to libBGPStream
 * Load balancing
 * Response windowing for overload protection
 * Support for live data processing
 
CAIDA operates a publicly accessible instance of the Broker that
libBGPStream is configured to query by default, the query APIs details
are available at the
<a href="{{ path('caida_bgpstream_web_homepage_docs', {'page': 'api', 'subpage':'broker'})}}">Broker HTTP API page</a>.



<br>

## Other data interfaces

### csvfile

In order for libBGPStream to correctly access the meta-data using the
csvfile data interface, the csvfile must comply the following format:

~~~
<dump-path>,<project>,<bgp-type>,<collector>,<dump-ts>,<duration>,<insertion-ts>
~~~

#### Example

The following line provides the meta-data for Route Views Updates dump
which is stored in the local folder. The dump was generated by the
Jinx collector and contains updates in the interval 1427846400 to
1427846400 + 900 (i.e. 15 minutes worth of updates).

~~~
routeviews.route-views.jinx.updates.1427846400.bz2,routeviews,updates,route-views.jinx,1427846400,900,1430438400
~~~

<br>

### sqlite

In order for libBGPStream to correctly access the meta-data using the
sqlite data interface, the sqlite must comply to a specific schema. In
order to facilitate the insertion of data into this kind of database, we
provide a script (*tools/bgpstream_sqlite_mgmt.py*) that adds new dump
meta-data to the database.

*bgpstream_sqlite_mgmt.py* inserts new dump's meta-data each time it
 is invocated and creates the database file if it does not exist.

~~~
usage: bgpstream_sqlite_mgmt.py [-h] [-l] [-M ADD_MRT_FILE] [-p PROJ]
                                [-c COLL] [-t BGP_TYPE] [-T FILE_TIME]
                                [-u UPDATES_TIME_SPAN]
                                sqlite_db
positional arguments:
  sqlite_db             file containing the sqlite database

optional arguments:
  -h, --help            show this help message and exit
  -l, --list_files      list the mrt files in the database
  -M ADD_MRT_FILE, --add_mrt_file ADD_MRT_FILE
                        path to the mrt file to add to the database
  -p PROJ, --proj PROJ  bgp project
  -c COLL, --coll COLL  bgp collector
  -t BGP_TYPE, --bgp_type BGP_TYPE
                        bgp type
  -T FILE_TIME, --file_time FILE_TIME
                        time associated with the mrt file
  -u UPDATES_TIME_SPAN, --updates_time_span UPDATES_TIME_SPAN
                        updates time span
~~~

<br>


### singlefile

Single file allows the user to access a single local or remote RIB
dump and/or Update dump 
(see 
<a href="{{ path('caida_bgpstream_web_homepage_docs', {'page': 'tools', 'subpage':'bgpreader'})}}">BGPReader</a> for more information).


